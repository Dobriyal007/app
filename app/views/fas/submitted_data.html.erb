<div class="container">
  <div class="row">
    <div class="col-2">
      <form class="form-inline">
        <div class="form-group mb-2">
          <div class="col-md-20">
            <label for="filterDateFrom">From Date:</label>
            <input type="date" id="filterDateFrom" class="form-control">
          </div>
          <div class="col-md-11">
            <label for="filterDateTo">To Date:</label>
            <input type="date" id="filterDateTo" class="form-control">
          </div>
          <div class="col-md-1 my-2">
            <button id="filterBtn" class="btn btn-primary">Filter</button>
          </div>
          <div class="col-md-1 my-2">
            <button id="resetBtn" class="btn btn-secondary">Reset</button>
          </div>
        </div>
      </form>
    </div>
    <div class="col-10">
      <h2 class="basic-head fw-bold text-center bg-primary p-3 my-3">Submitted Data</h2>
      <table class="table table-striped table-bordered align-middle text-center">
          <tbody>
            <tr>
              <th style="width: 80px">Sr No.</th>
              <th>Date</th>
              <th>Time</th>
              <th>Line</th>
              <th style="width: 100px">Model</th>
              <th style="width: 330px">Barcode</th>
              <th style="width: 130px">Out Date</th>
              <th>Out Time</th>
              <th style="width: 100px">FT Status</th>
              <th>Remarks</th>
              <th>Time Gap</th>
            </tr>
            <% serial_number = 0 %>
            <% @submitted_fas.reverse_each.with_index(1) do |fa, index| %>
              <% fa.barcodes.each do |barcode| %>
                <% serial_number += 1 %>
                <tr class="table-row">
                  <td><%= serial_number %></td>
                  <td><%= fa.date&.strftime('%Y-%m-%d') %></td>
                  <td><%= fa.time&.strftime('%H:%M:%S') %></td>
                  <td><%= fa.Line %></td>
                  <td><%= fa.Model %></td>
                  <td><%= barcode.value %></td>
                  <td>
                    <% if barcode.status.present? %>
                      <%= barcode.updated_at&.strftime('%Y-%m-%d') %>
                    <% else %>
                      <%= '' %>
                    <% end %>
                  </td>
                  <td>
                    <% if barcode.status.present? %>
                      <%= barcode.updated_at&.strftime('%H:%M:%S') %>
                    <% else %>
                      <%= '' %>
                    <% end %>
                  </td>
                  <td class="<%= 'text-danger' if barcode.status == 'NG' %>"><%= barcode.status %></td>
                  <td><%= barcode.remarks %></td>
                  <td>
                    <% if barcode.updated_at.present? && fa.time.present? && barcode.status.present? %>
                      <% updated_at_time = barcode.updated_at.to_time %>
                      <% fa_time = fa.time.to_time %>
                      <% time_difference = (updated_at_time - fa_time).abs %>
                      <%= Time.at(time_difference).utc.strftime('%H:%M:%S') %>
                    <% else %>
                      <%= '' %>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            <% end %>
          </tbody>
      </table>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<style type="text/css">
  .container {
    max-width: 1600px;
  }
  .mb-2 {
    margin-top: 6.5rem!important;
  }
  .col-2 {
    width: 15%;
  }
</style>

<script>
  $(document).ready(function() {
    $("#filterBtn").on("click", function() {
      const fromDate = $("#filterDateFrom").val();
      const toDate = $("#filterDateTo").val();

      $(".table-row").each(function() {
        const rowDate = $(this).find("td:eq(1)").text(); // Assuming the date is in the second column, adjust as needed

        if (isValidDate(fromDate) && isValidDate(toDate)) {
          const dateFrom = new Date(fromDate);
          const dateTo = new Date(toDate);
          const rowDateObj = new Date(rowDate);

          if (rowDateObj >= dateFrom && rowDateObj <= dateTo) {
            $(this).show();
          } else {
            $(this).hide();
          }
        } else {
          // Handle invalid dates if needed
        }
      });
    });

    $("#resetBtn").on("click", function() {
      $(".table-row").show();
    });

    function isValidDate(dateString) {
      // Check if the dateString is a valid date
      return dateString && !isNaN(new Date(dateString).getTime());
    }
  });
</script>

